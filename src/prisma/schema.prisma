datasource db {
    provider = "sqlserver"
    url      = "sqlserver://dpaschoal-teste-server.database.windows.net:1433;database=dpaschoal_teste;user=teste;password=123@qwer;encrypt=true"
}

generator client {
    provider = "prisma-client-js"
}

model Curso {
  id               Int        @id @default(autoincrement())
  titulo           String
  descricao        String     @db.Text
  academia         Academia   @relation(fields: [fk_Academia_id], references: [id])
  fk_Academia_id   Int
  usuario          Usuario    @relation(fields: [fk_Usuario_id], references: [id])
  fk_Usuario_id    Int
  telas            TelaCurso[] // Confirme se TelaCurso é a entidade correta
  realizados       Realiza[]  // Confirme a estrutura da entidade Realiza
  data_criacao     DateTime   @default(now())
  capa             String
  listaDeSlides    Slide[]    // Confirme se Slide é a entidade correta
}

model Slide {
  id            Int      @id @default(autoincrement())
  slideType     String
  midia         String?
  question      String?
  options       String? //Está puxando a lista em uma unica string, para exibir na tela deve-se utitlizar json.parse() para transformar em lista novamente.
  correctOption String?
  points        Int?
  curso         Curso?    @relation(fields: [cursoId], references: [id])
  cursoId       Int?
}

model Usuario {
    id Int @id @default(autoincrement()) 
    email String @db.NVarChar(100) @unique
    nome String  @db.NVarChar(100)
    senha String  @db.NVarChar(100)
    celular String  @db.NVarChar(100)
    estado  String  @db.NVarChar(100)
    cep String  @db.NVarChar(100)
    bairro  String  @db.NVarChar(100)
    rua String  @db.NVarChar(100)
    data_nascimento DateTime  
    colaborador Boolean
    profissao String  @db.NVarChar(100)
    cargo Cargo @relation(fields: [cargoId], references: [id])
    cargoId Int @map("fk_Cargo_id")
    academia Academia[]
    curso Curso[]
    realizados Realiza[]
    promotor Promove[] @relation("adm")
    promovido Promove[] @relation("instrutor")
    tokens AuthenticationToken[]
}

model Academia {
    id Int @id @default(autoincrement())
    nome String  @db.NVarChar(100)
    descricao String  @db.NVarChar(100)
    imagem String? 
    cursos Curso[]
    usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    usuarioId Int @map("fk_Usuario_id")
    data_criacao DateTime @db.DateTime
}

model TelaCurso{
    id Int @id @default(autoincrement())
    texto String
    midia String
    resposta String
    pergunta String
    curso Curso @relation(fields:[cursoId], references:[id])
    cursoId Int @map("fk_Curso_id")
}

model Promove{
    @@id([admId, instrutorId])
    adm Usuario @relation("adm", fields: [admId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    admId Int @map("fk_Usuario_id")
    instrutor Usuario @relation("instrutor", fields: [instrutorId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    instrutorId Int @map("fk_Usuario_id_")

}

model Realiza {
    @@id([usuarioId, cursoId])
    usuario Usuario @relation(fields: [usuarioId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    usuarioId Int @map("fk_Usuario_id")
    curso Curso @relation(fields:[cursoId], references:[id])
    cursoId Int @map("fk_Curso_id")
    questoes_acertadas Int 
    questoes_erradas Int
    data_inicio DateTime
    data_fim DateTime
}

model Cargo {
    id Int @id @default(autoincrement())
    nome String
    usuarios Usuario[]
}

model AuthenticationToken{
    id Int @id @default(autoincrement())
    token String @unique
    data_criacao DateTime
    expirado Boolean
    usuario Usuario @relation(fields:[usuarioId], references: [id], onDelete: NoAction, onUpdate: NoAction)
    usuarioId Int @map("fk_Usuario_id")
}
